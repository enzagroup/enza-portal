openapi: 3.0.1
info:
  title: Enza REST API Documentation
  description: |
    **Welcome to the Enza REST API Developer Portal**
    
    Our API provides seamless integration for instant issuing services across Africa. This portal offers all the necessary tools, detailed documentation, and API endpoints required to empower your financial operations with real-time card issuance capabilities.
    
    ## Key Features
    - **Instant Card Issuance**: Issue physical and virtual cards in real-time
    - **Card Management**: Complete lifecycle management from creation to closure
    - **Transaction Monitoring**: Real-time transaction tracking and reporting
    - **PIN Management**: Secure PIN operations for enhanced security
    - **E-Commerce Controls**: Manage online transaction capabilities
    
    ## Getting Started
    All API requests require:
    - `x-api-key` is required for authentication
    
    Base URL: `https://uat-api.enza.cloud/TX/v1`
  version: 2025-02-16T14:26:47Z

servers:
  - url: https://uat-api.enza.cloud/TX/v1

tags:
  - name: "Card Management"
    description: "Operations for creating, activating, and managing card status"
  - name: "Card Information"
    description: "Retrieve card details and customer card information"
  - name: "Transactions"
    description: "View and manage card transaction history"
  - name: "E-Commerce"
    description: "Manage e-commerce and online transaction settings"
  - name: "PIN Management"
    description: "Set and change card PINs securely"
  - name: "Instant Issuing"
    description: "Instant card issuance for new and existing customers"

paths:
  ##Customer
  ##CARDS
  
  /instantissuing:
    post:
      operationId: instantIssueCard
      summary: Instant Issue Card
      description: |
        Instantly issue a card for a new or existing customer.
        
        This endpoint handles two scenarios:
        
        | Scenario                | RequestType Value           |
        |-------------------------|-----------------------------|
        | New customer            | `NewAccountNewCustomer`     |
        | Existing customer       | `NewAccountExistingCustomer`|

      tags:
        - Instant Issuing
      parameters:
        - $ref: '#/components/parameters/apiKey'
        - $ref: '#/components/parameters/contentType'

      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Customer'
            example:
              RequestType: NewAccountNewCustomer
              LastName: EEE
              FirstName: Cust02
              BirthDate: 1990-01-20
              Passport: "76238310075"
              Email: test@test.com
              MobilePhone: '9991234567'
              StreetTitle: Baker's Str
              Zip: WC1X 9NX
              AccountNum: AAABBB150573
              CardRefNum: '000515'
              EmbossedName: Cust02 New

      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessEnvelope'
              examples:
                directSuccess:
                  summary: Direct success example
                  value:
                    code: SUCCESS_REQUEST_PROCESSED
                    params:
                      requestType: NewAccountNewCustomer

        '400':
          description: Bad request – validation failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BadRequest'
              examples:
                validationFailure:
                  summary: Missing required field
                  value:
                    code: ERR_VALIDATION_FAILED
                    params:
                      missingProperty: RequestType
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '409':
          description: 'Conflict – card already assigned'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CardAlreadyAssigned'
              examples:
                conflictError:
                  summary: Card already assigned example
                  value:
                    code: ERR_CARD_ALREADY_ASSIGNED
                    params:
                      message: This Card Is Already Assigned To A Customer!

        '500':
          $ref: '#/components/responses/InternalServerError'
        '504':
          description: Gateway Timeout
          content:
            application/json:
              schema:
                type: object
                required: [errorMessage]
                properties:
                  errorMessage:
                    type: string
                    description: Timeout error message
                    example: Task timed out after 1.10 seconds
              examples:
                lambdaTimeout:
                  summary: Lambda execution timed out
                  value:
                    errorMessage: Task timed out after 1.10 seconds

  /cards/tdsenrollement:
    post:
      operationId: updateEcommerceStatus
      summary: Enable or Disable E-Commerce Transactions
      description: |
        Control e-commerce (online) transaction capabilities for a card.
      tags:
        - E-Commerce
      parameters:
        - $ref: '#/components/parameters/apiKey'
        - $ref: '#/components/parameters/contentType'
      requestBody:
        description: Details for updating ECstatus of a card.
        content:
          application/json:
            schema:
              type: object
              required: [ECstatusEnable, CardRefNum]
              properties:
                CardRefNum:
                  type: string
                  description: "**Required.** Card reference number"
                ECstatusEnable:
                  type: string
                  description: '**Required.** EC status: `"1"` = Enrolled, `"0"` = Not enrolled'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                required:
                  - code
                  - params
                properties:
                  code:
                    type: string
                    example: SUCCESS_ECSTATUS_CHANGED
                  params:
                    type: object
                    required:
                      - status
                    properties:
                      status:
                        type: string
                        example: Enabled
              examples:
                successResponse:
                  summary: Successful Request Example
                  value:
                    code: SUCCESS_ECSTATUS_CHANGED
                    params:
                      status: Enabled
        '400':
          description: 'Bad request – validation failed'
          content:
            application/json:
              schema:
                type: object
                required:
                  - code
                  - params
                properties:
                  code:
                    type: string
                    example: ERR_VALIDATION_FAILED
                  params:
                    type: object
                    required:
                      - missingProperty
                    properties:
                      missingProperty:
                        type: string
                        example: CardRefNum
              examples:
                badRequestExample:
                  summary: Missing required field
                  value:
                    code: ERR_VALIDATION_FAILED
                    params:
                      missingProperty: CardRefNum
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '409':
          description: 'Conflict – card not found'
          content:
            application/json:
              schema:
                type: object
                required:
                  - code
                  - params
                properties:
                  code:
                    type: string
                    example: ERR_READTOKEN_DECLINED
                  params:
                    type: object
                    required:
                      - message
                    properties:
                      message:
                        type: string
                        example: Card not found
              examples:
                conflictExample:
                  summary: Card not found
                  value:
                    code: ERR_READTOKEN_DECLINED
                    params:
                      message: Card not found
        '500':
          $ref: '#/components/responses/InternalServerError'
        '504':
          $ref: '#/components/responses/LambdaTimeout'

  /cards/cardstatus:
    post:
      operationId: updateCardStatusByRefNum
      tags:
        - Card Management
      summary: Update Card Status by Reference Number
      description: |
        Update card status using the card reference number.
        
        **Allowed Statuses:**
        - **Active**: Enable card for transactions
        - **Deactivated**: Temporarily deactivate the card
      parameters:
        - $ref: '#/components/parameters/apiKey'
        - $ref: '#/components/parameters/contentType'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - CardStatus
                - CardRefNum
              properties:
                CardStatus:
                  type: string
                  description: "**Required.** Allowed values ⇒ **Active** | **Deactivated**"
                  enum: [Active, Deactivated]   # ← this drives the drop-down
                  example: Active
                CardRefNum:
                  type: string
                  description: "**Required.** Unique card reference number"
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                required:
                  - code
                  - params
                properties:
                  code:
                    type: string
                    example: SUCCESS_CARDSTATUS_CHANGED
                  params:
                    type: object
                    required:
                      - status
                    properties:
                      status:
                        type: string
                        example: Active
              examples:
                successResponse:
                  summary: Successful card-status change
                  value:
                    code: SUCCESS_CARDSTATUS_CHANGED
                    params:
                      status: Active
        '400':
          description: 'Bad request – validation failed'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
              examples:
                badRequestExample:
                  summary: Missing required field
                  value:
                    code: ERR_VALIDATION_FAILED
                    params:
                      message: "Missing required field: CardRefNum"
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '409':
          description: 'Conflict – card declined'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConflictError'
              examples:
                conflictExample:
                  summary: 'Card declined – token not found'
                  value:
                    code: ERR_CARD_DECLINED
                    params:
                      message: Card not found
        '500':
          $ref: '#/components/responses/InternalServerError'
        '504':
          $ref: '#/components/responses/LambdaTimeout'

  ##PIN Management
  /pin/setting_pin:
    post:
      operationId: setCardPin
      summary: Set PIN for Card
      description: |
        Set a new PIN for a card using the encrypted PIN block.
      tags:
        - PIN Management
      parameters:
        - $ref: '#/components/parameters/apiKey'
        - $ref: '#/components/parameters/contentType'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PinSetting'
            example:
              Pan: "1234567890123456"
              PinBlock: "ABC123DEF456"
      responses:
        '200':
          description: PIN successfully set
          content:
            application/json:
              schema:
                type: object
                required:
                  - code
                  - params
                properties:
                  code:
                    type: string
                    example: SUCCESS_PIN_SET
                  params:
                    type: object
              examples:
                successResponse:
                  summary: PIN Set Successfully
                  value:
                    code: SUCCESS_PIN_SET
                    params: {}
        '400':
          description: 'Bad request – validation failed'
          content:
            application/json:
              schema:
                type: object
                required:
                  - code
                  - params
                properties:
                  code:
                    type: string
                    example: ERR_VALIDATION_FAILED
                  params:
                    type: object
                    properties:
                      missingProperty:
                        type: string
                        example: Pan
              examples:
                badRequestExample:
                  summary: Missing required field
                  value:
                    code: ERR_VALIDATION_FAILED
                    params:
                      missingProperty: Pan
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '409':
          description: 'Conflict – PIN setting declined'
          content:
            application/json:
              schema:
                type: object
                required:
                  - code
                  - params
                properties:
                  code:
                    type: string
                    example: ERR_PIN_SETTING_DECLINED
                  params:
                    type: object
                    required:
                      - message
                    properties:
                      message:
                        type: string
                        example: "Error importing PIN block: Input length not multiple of 8 bytes"
              examples:
                conflictExample:
                  summary: PIN setting declined
                  value:
                    code: ERR_PIN_SETTING_DECLINED
                    params:
                      message: "Error importing PIN block: Input length not multiple of 8 bytes"
        '500':
          $ref: '#/components/responses/InternalServerError'
        '504':
          description: Request timeout
          content:
            application/json:
              schema:
                type: object
                required:
                  - code
                  - params
                properties:
                  code:
                    type: string
                    example: ERR_TIMEOUT
                  params:
                    type: object
                    required:
                      - message
                    properties:
                      message:
                        type: string
                        example: Request timeout. Please try again later.
              examples:
                timeoutExample:
                  summary: Request timeout
                  value:
                    code: ERR_TIMEOUT
                    params:
                      message: Request timeout. Please try again later.

  /pin/changing_pin:
    post:
      operationId: changeCardPin
      summary: Change PIN for Card
      description: |
        Change a card's PIN by providing both the current and new encrypted PIN blocks.
      tags:
        - PIN Management
      parameters:
        - $ref: '#/components/parameters/apiKey'
        - $ref: '#/components/parameters/contentType'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PinChanging'
            example:
              Pan: "1234567890123456"
              oldPinBlock: "OLD123PIN456"
              newPinBlock: "NEW789PIN012"
      responses:
        '200':
          description: PIN successfully changed
          content:
            application/json:
              schema:
                type: object
                required:
                  - code
                  - params
                properties:
                  code:
                    type: string
                    example: SUCCESS_PIN_CHANGED
                  params:
                    type: object
              examples:
                successResponse:
                  summary: PIN Changed Successfully
                  value:
                    code: SUCCESS_PIN_CHANGED
                    params: {}
        '400':
          description: 'Bad request – validation failed'
          content:
            application/json:
              schema:
                type: object
                required:
                  - code
                  - params
                properties:
                  code:
                    type: string
                    example: ERR_VALIDATION_FAILED
                  params:
                    type: object
                    properties:
                      missingProperty:
                        type: string
                        example: oldPinBlock
              examples:
                badRequestExample:
                  summary: Missing required field
                  value:
                    code: ERR_VALIDATION_FAILED
                    params:
                      missingProperty: oldPinBlock
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '409':
          description: 'Conflict – PIN change declined'
          content:
            application/json:
              schema:
                type: object
                required:
                  - code
                  - params
                properties:
                  code:
                    type: string
                    example: ERR_PIN_CHANGE_DECLINED
                  params:
                    type: object
                    required:
                      - message
                    properties:
                      message:
                        type: string
                        example: "Error importing PIN block: bad PIN block format"
              examples:
                conflictExample:
                  summary: PIN change declined
                  value:
                    code: ERR_PIN_CHANGE_DECLINED
                    params:
                      message: "Error importing PIN block: bad PIN block format"
        '500':
          $ref: '#/components/responses/InternalServerError'
        '504':
          description: Request timeout
          content:
            application/json:
              schema:
                type: object
                required:
                  - code
                  - params
                properties:
                  code:
                    type: string
                    example: ERR_TIMEOUT
                  params:
                    type: object
                    required:
                      - message
                    properties:
                      message:
                        type: string
                        example: Request timeout. Please try again later.
              examples:
                timeoutExample:
                  summary: Request timeout
                  value:
                    code: ERR_TIMEOUT
                    params:
                      message: Request timeout. Please try again later.

  /cards/cardStatusById:
    post:
      operationId: updateCardStatusById
      tags:
        - Card Management
      summary: Update Card Status by Card ID
      description: |
        Update card status using the internal card ID (TokenId).
        
        **Supported Statuses:**
        - **Active**: Enable card for transactions
        - **Deactivated**: Temporarily disable the card
        - **Blocked**: Block card due to security concerns
        
        **Optional**: Provide a reason for the status change for audit purposes.
      parameters:
        - $ref: '#/components/parameters/apiKey'
        - $ref: '#/components/parameters/contentType'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - CardStatus
                - CardId
              properties:
                CardStatus:
                  type: string
                  description: "**Required.** Allowed values ⇒ **Active** | **Deactivated** | **Blocked**"
                  enum: [Active, Deactivated, Blocked]
                  example: Active
                CardId:
                  type: string
                  description: "**Required.** Unique card ID (token ID)"
                  example: "12345"
                Reason:
                  type: string
                  description: Optional reason for status change
                  example: "Customer request"
      responses:
        '200':
          description: Card status successfully changed
          content:
            application/json:
              schema:
                type: object
                required:
                  - code
                  - params
                properties:
                  code:
                    type: string
                    example: SUCCESS_CARDSTATUS_CHANGED
                  params:
                    type: object
                    required:
                      - status
                    properties:
                      status:
                        type: string
                        example: Active
              examples:
                successResponse:
                  summary: Successful card-status change
                  value:
                    code: SUCCESS_CARDSTATUS_CHANGED
                    params:
                      status: Active
        '400':
          description: 'Bad request – validation failed'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
              examples:
                badRequestExample:
                  summary: Missing required field
                  value:
                    code: ERR_VALIDATION_FAILED
                    params:
                      message: "Missing required field: CardId"
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '409':
          description: 'Conflict – card status change declined'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConflictError'
              examples:
                conflictExample:
                  summary: Card declined
                  value:
                    code: ERR_CARD_DECLINED
                    params:
                      message: Card activation was declined
        '500':
          $ref: '#/components/responses/InternalServerError'
        '504':
          $ref: '#/components/responses/LambdaTimeout'

  /cards/card-details/{card_Id}:
    get:
      operationId: getCardDetails
      tags:
        - Card Information
      summary: Get Card Details by Card ID
      description: |
        Retrieve comprehensive card information using the card ID (TokenId).
        
      parameters:
        - $ref: '#/components/parameters/apiKey'
        - $ref: '#/components/parameters/contentType'
        - name: card_Id
          in: path
          required: true
          description: Card ID (TokenId) to retrieve details for
          schema:
            type: string
            example: "12345"
      responses:
        '200':
          description: Card details successfully retrieved
          content:
            application/json:
              schema:
                type: object
                required:
                  - code
                  - params
                properties:
                  code:
                    type: string
                    example: SUCCESS_CARD_DETAILS_RETRIEVED
                  params:
                    type: object
                    required:
                      - maskedPan
                      - status
                      - expiryDate
                      - availableBalance
                      - currency
                    properties:
                      maskedPan:
                        type: string
                        description: Masked Primary Account Number
                        example: "123456******1234"
                      status:
                        type: string
                        description: Current card status
                        example: "Active"
                      expiryDate:
                        type: string
                        format: date
                        description: Card expiry date
                        example: "2025-12-31"
                      availableBalance:
                        type: string
                        description: Available balance on the card
                        example: "1500.00"
                      currency:
                        type: string
                        description: Currency code or symbol
                        example: "USD"
              examples:
                successResponse:
                  summary: Successful card details retrieval
                  value:
                    code: SUCCESS_CARD_DETAILS_RETRIEVED
                    params:
                      maskedPan: "123456******1234"
                      status: "Active"
                      expiryDate: "2025-12-31"
                      availableBalance: "1500.00"
                      currency: "USD"
        '400':
          description: 'Bad request – validation failed'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
              examples:
                badRequestExample:
                  summary: Missing required field
                  value:
                    code: ERR_VALIDATION_FAILED
                    params:
                      message: "Missing required field: cardId"
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '504':
          $ref: '#/components/responses/LambdaTimeout'

  /customers/listofcards:
    post:
      operationId: listCustomerCards
      tags:
        - Card Information
      summary: List All Customer Cards
      description: |
        Retrieve all cards issued to a customer using their identification document.
        
        **Search By:**
        - Passport number, OR National ID number
      parameters:
        - $ref: '#/components/parameters/apiKey'
        - $ref: '#/components/parameters/contentType'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - NationalId
                - Passport
              properties:
                Passport:
                  type: string
                  description: Either NationalId or Passport is required. Customer's passport number
                  example: "76238310075"
                NationalId:
                  type: string
                  description: Either NationalId or Passport is required. Customer's national ID
                  example: "1234567890"
            example:
              Passport: "76238310075"
      responses:
        '200':
          description: Cards successfully retrieved
          content:
            application/json:
              schema:
                type: object
                required:
                  - code
                  - params
                properties:
                  code:
                    type: string
                    example: SUCCESS_CARDS_RETRIEVED
                  params:
                    type: object
                    required:
                      - totalCards
                      - cards
                    properties:
                      totalCards:
                        type: integer
                        description: Total number of cards found
                        example: 2
                      cards:
                        type: array
                        items:
                          type: object
                          properties:
                            cardId:
                              type: string
                              description: Card token ID
                              example: "12345"
                            maskedPan:
                              type: string
                              description: Masked card PAN
                              example: "123456******1234"
                            productName:
                              type: string
                              description: Card product name
                              example: "Visa Debit Card"
                            status:
                              type: string
                              description: Card status
                              example: "Active"
                            expiryDate:
                              type: string
                              format: date
                              description: Card expiry date
                              example: "2025-12-31"
              examples:
                successResponse:
                  summary: Successful cards retrieval
                  value:
                    code: SUCCESS_CARDS_RETRIEVED
                    params:
                      totalCards: 2
                      cards:
                        - cardId: "12345"
                          maskedPan: "123456******1234"
                          productName: "Visa Debit Card"
                          status: "Active"
                          expiryDate: "2025-12-31"
                        - cardId: "67890"
                          maskedPan: "123456******5678"
                          productName: "Mastercard Debit"
                          status: "Deactivated"
                          expiryDate: "2026-06-30"
        '400':
          description: 'Bad request – validation failed'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
              examples:
                badRequestExample:
                  summary: Missing identification document
                  value:
                    code: ERR_VALIDATION_FAILED
                    params:
                      message: Either Passport or NationalId is required
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '409':
          description: Customer not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConflictError'
              examples:
                customerNotFound:
                  summary: Customer not found
                  value:
                    code: ERR_CUSTOMER_NOT_FOUND
                    params:
                      message: Customer doesn't exist
        '500':
          $ref: '#/components/responses/InternalServerError'
        '504':
          $ref: '#/components/responses/LambdaTimeout'

  /cards/list-of-transactions:
    post:
      operationId: getTransactionHistory
      tags:
        - Transactions
      summary: Get Transaction History
      description: |
        Retrieve detailed transaction history for a card within a specified date range.
        
        **Date Range:** Specify startDate and endDate to filter transactions
        
      parameters:
        - $ref: '#/components/parameters/apiKey'
        - $ref: '#/components/parameters/contentType'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - cardId
                - startDate
                - endDate
              properties:
                cardId:
                  type: string
                  description: "**Required.** Card Token ID"
                  example: "12345"
                startDate:
                  type: string
                  format: date
                  pattern: '^\d{4}-\d{2}-\d{2}$'
                  description: "**Required.** Start date in YYYY-MM-DD format"
                  example: "2025-01-01"
                endDate:
                  type: string
                  format: date
                  pattern: '^\d{4}-\d{2}-\d{2}$'
                  description: "**Required.** End date in YYYY-MM-DD format"
                  example: "2025-01-31"
            example:
              cardId: "12345"
              startDate: "2025-01-01"
              endDate: "2025-01-31"
      responses:
        '200':
          description: Transactions successfully retrieved
          content:
            application/json:
              schema:
                type: object
                required:
                  - code
                  - params
                properties:
                  code:
                    type: string
                    example: SUCCESS_TRANSACTIONS_RETRIEVED
                  params:
                    type: object
                    required:
                      - cardId
                      - startDate
                      - endDate
                      - totalTransactions
                      - transactions
                    properties:
                      cardId:
                        type: string
                        description: Card ID
                        example: "3280"
                      startDate:
                        type: string
                        format: date
                        description: Start date of query
                        example: "2025-07-01"
                      endDate:
                        type: string
                        format: date
                        description: End date of query
                        example: "2025-10-02"
                      totalTransactions:
                        type: integer
                        description: Total number of transactions
                        example: 31
                      transactions:
                        type: array
                        items:
                          type: object
                          required:
                            - transactionId
                            - transactionKind
                            - transactionLabel
                            - transactionType
                            - amount
                            - currency
                            - date
                            - timestamp
                            - terminalOwnerTitle
                            - terminalType
                          properties:
                            transactionId:
                              type: string
                              description: Unique transaction identifier
                              example: "251002511421445346"
                            transactionKind:
                              type: string
                              description: Kind of transaction
                              example: "Goods"
                            transactionLabel:
                              type: string
                              description: Transaction label
                              example: "Purchase"
                            transactionType:
                              type: string
                              description: Transaction type (Debit/Credit)
                              example: "Debit"
                            amount:
                              type: number
                              description: Transaction amount
                              example: 45
                            currency:
                              type: string
                              description: Currency code
                              example: "USD"
                            date:
                              type: string
                              format: date
                              description: Transaction date
                              example: "2025-10-02"
                            timestamp:
                              type: string
                              format: date-time
                              description: Transaction timestamp
                              example: "2025-10-02T14:12:22.000"
                            terminalOwnerTitle:
                              type: string
                              description: Terminal owner/acquirer name
                              example: "ACQUIRER NAME"
                            terminalType:
                              type: string
                              description: Type of terminal
                              example: "Pos"
              examples:
                successResponse:
                  summary: Successful transactions retrieval
                  value:
                    code: SUCCESS_TRANSACTIONS_RETRIEVED
                    params:
                      cardId: "3280"
                      startDate: "2025-07-01"
                      endDate: "2025-10-02"
                      totalTransactions: 2
                      transactions:
                        - transactionId: "251002511421445346"
                          transactionKind: "Goods"
                          transactionLabel: "Purchase"
                          transactionType: "Debit"
                          amount: 45
                          currency: "USD"
                          date: "2025-10-02"
                          timestamp: "2025-10-02T14:12:22.000"
                          terminalOwnerTitle: "ACQUIRER NAME"
                          terminalType: "Pos"
                        - transactionId: "250925476227641819"
                          transactionKind: "Goods"
                          transactionLabel: "Purchase"
                          transactionType: "Debit"
                          amount: 21
                          currency: "USD"
                          date: "2025-09-25"
                          timestamp: "2025-09-25T13:13:42.000"
                          terminalOwnerTitle: "ACQUIRER NAME"
                          terminalType: "Pos"
        '400':
          description: 'Bad request – validation failed'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
              examples:
                badRequestExample:
                  summary: Invalid date format
                  value:
                    code: ERR_VALIDATION_FAILED
                    params:
                      message: Invalid startDate format
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '500':
          $ref: '#/components/responses/InternalServerError'
        '504':
          $ref: '#/components/responses/LambdaTimeout'

  /cards/create-card:
    post:
      operationId: createCardWithOnboarding
      tags:
        - Card Management
      summary: Create Card
      description: |
        Complete end-to-end card issuance with customer onboarding.
        
        **Supports both New and Existing Customers:**
        - **New Customer**: Creates customer profile and issues card
        - **Existing Customer**: Links card to existing customer profile
        
        **Process Flow:**
        1. **Customer Verification**: Check if customer exists using document ID (NationalId or Passport)
        2. **Customer Creation**: Create new customer profile (if new) OR link to existing customer
        3. **Card Activation**: Automatically activate the card (status = Active)
        4. **Card Details**: Retrieve PAN and calculate CVV2
        5. **Notifications**: Set up SMS/Email notifications (if enabled)
        
      parameters:
        - $ref: '#/components/parameters/apiKey'
        - $ref: '#/components/parameters/contentType'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCardStandard'
            example:
              FirstName: "John"
              LastName: "Doe"
              MiddleName: "William"
              BirthDate: "1990-01-15"
              NationalId: "1234567890"
              Email: "john.doe@example.com"
              MobilePhone: "1234567890"
              StreetTitle: "123 Main Street"
              Zip: "12345"
              NotificationStatus: "enabled"
      responses:
        '200':
          description: Card successfully created
          content:
            application/json:
              schema:
                type: object
                required:
                  - code
                  - params
                properties:
                  code:
                    type: string
                    example: SUCCESS_REQUEST_PROCESSED
                  params:
                    type: object
                    required:
                      - customerType
                      - personId
                      - cardId
                      - cardDetails
                      - notificationEnabled
                    properties:
                      customerType:
                        type: string
                        enum: [New, Existing]
                        description: Whether customer is new or existing
                        example: New
                      personId:
                        type: string
                        description: Customer person ID
                        example: "PERS12345"
                      cardId:
                        type: string
                        description: Card token ID
                        example: "12345"
                      cardDetails:
                        type: object
                        required:
                          - pan
                          - cvv2
                        properties:
                          pan:
                            type: string
                            description: Primary Account Number
                            example: "1234567890123456"
                          cvv2:
                            type: string
                            description: Card verification value
                            example: "123"
                      notificationEnabled:
                        type: boolean
                        description: Whether notifications are enabled
                        example: true
                      notificationStatus:
                        type: string
                        description: Notification status message (only if already existed)
                        example: "Already Enabled"
              examples:
                successResponse:
                  summary: Card created successfully
                  value:
                    code: SUCCESS_REQUEST_PROCESSED
                    params:
                      customerType: New
                      personId: "PERS12345"
                      cardId: "12345"
                      cardDetails:
                        pan: "1234567890123456"
                        cvv2: "123"
                      notificationEnabled: true
        '400':
          description: 'Bad request – validation failed'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
              examples:
                badRequestExample:
                  summary: Validation failed
                  value:
                    code: ERR_VALIDATION_FAILED
                    params:
                      message: Invalid Email format
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '409':
          description: 'Conflict – operation declined'
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConflictError'
              examples:
                requestDeclined:
                  summary: New customer request declined
                  value:
                    code: ERR_REQUEST_DECLINED
                    params:
                      message: New customer request declined
                existingGroupDeclined:
                  summary: Existing customer group declined
                  value:
                    code: ERR_EXISTING_GROUP_DECLINED
                    params:
                      message: Existing customer group declined
                activateCardDeclined:
                  summary: Card activation declined
                  value:
                    code: ERR_ACTIVATE_CARD_DECLINED
                    params:
                      message: Card activation declined
                notificationDeclined:
                  summary: Notification contract declined
                  value:
                    code: ERR_NOTIFICATION_DECLINED
                    params:
                      message: Notification contract declined
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                required:
                  - code
                  - params
                properties:
                  code:
                    type: string
                    example: ERR_INTERNAL_SERVER_ERROR
                  params:
                    type: object
                    required:
                      - message
                    properties:
                      message:
                        type: string
                        example: An unexpected error occurred. Please try again later.
              examples:
                internalServerError:
                  summary: Internal server error
                  value:
                    code: ERR_INTERNAL_SERVER_ERROR
                    params:
                      message: An unexpected error occurred. Please try again later.
        '504':
          $ref: '#/components/responses/LambdaTimeout'

components:
  responses:
    LambdaTimeout:
      description: 'Gateway Timeout – task took too long'
      content:
        application/json:
          schema:
            type: object
            required: [errorMessage]
            properties:
              errorMessage:
                type: string
                example: Task timed out after 1.10 seconds
          examples:
            lambdaTimeout:
              summary: Lambda execution timed out
              value:
                errorMessage: Task timed out after 1.10 seconds
    
    AuthenticationError:
      description: 'Authentication context is missing or invalid'
      content:
        application/json:
          schema:
            type: object
            required: [code, params]
            properties:
              code:
                type: string
                example: ERR_AUTH_CONTEXT
              params:
                type: object
                required: [message]
                properties:
                  message:
                    type: string
                    example: Authentication context is missing
          examples:
            authError:
              summary: Authentication error
              value:
                code: ERR_AUTH_CONTEXT
                params:
                  message: Authentication context is missing
    
    InternalServerError:
      description: 'An unexpected error occurred'
      content:
        application/json:
          schema:
            type: object
            required: [code, params]
            properties:
              code:
                type: string
                example: ERR_INTERNAL_SERVER_ERROR
              params:
                type: object
                required: [message]
                properties:
                  message:
                    type: string
                    example: An unexpected error occurred. Please try again later.
          examples:
            internalError:
              summary: Internal server error
              value:
                code: ERR_INTERNAL_SERVER_ERROR
                params:
                  message: An unexpected error occurred. Please try again later.

  schemas:
    SuccessEnvelope:
      type: object
      required: [code, params]
      properties:
        code:
          type: string
          example: SUCCESS_REQUEST_PROCESSED
        params:
          type: object
          required: [requestType]
          properties:
            requestType:
              type: string
              example: NewAccountNewCustomer

    BadRequest:
      type: object
      required: [code, params]
      properties:
        code:
          type: string
          example: ERR_VALIDATION_FAILED
        params:
          type: object
          required: [missingProperty]
          properties:
            missingProperty:
              type: string
              example: RequestType

    CardAlreadyAssigned:
      type: object
      required: [code, params]
      properties:
        code:
          type: string
          example: ERR_CARD_ALREADY_ASSIGNED
        params:
          type: object
          required: [message]
          properties:
            message:
              type: string
              example: This Card Is Already Assigned To A Customer!

    Customer:
      type: object
      required:
        [RequestType, AccountNum, CardRefNum, EmbossedName, NationalId, Passport, FirstName, LastName]
      properties:
        RequestType:
          type: string
          description: |
            **Required.** Request type:
            - `NewAccountNewCustomer`: New customer  
            - `NewAccountExistingCustomer`: Existing customer
        CardRefNum:
          type: string
          description: "**Required.** Card reference number"
        EmbossedName:
          type: string
          description: "**Required.** Name to be embossed on the card"
        AccountNum:
          type: string
          description: "**Required.** Account number to link to the card"
        FirstName:
          type: string
          description: "**Required for new customers.** Customer's first name"
        MiddleName:
          type: string
          description: Optional. Customer's middle name
        LastName:
          type: string
          description: "**Required for new customers.** Customer's last name"
        NationalId:
          type: string
          description: Either NationalId or Passport is required. Customer's national ID
        Passport:
          type: string
          description: Either NationalId or Passport is required. Customer's passport number
        BirthDate:
          type: string
          format: date          
          pattern: '^\d{4}-\d{2}-\d{2}$'
          description: "Date of birth in YYYY-MM-DD format"
          example: '1990-01-01'       
        Email:
          type: string
          format: email
          description: "Customer's email address"
        MobilePhone:
          type: string
          description: "Customer's mobile phone number"
        StreetTitle:
          type: string
          description: "Customer's street address"
        Zip:
          type: string
          description: "Customer's postal code"

    PinSetting:
      type: object
      required:
        - Pan
        - PinBlock
      properties:
        Pan:
          type: string
          description: "**Required.** The Primary Account Number (PAN) of the card"
          example: "1234567890123456"
        PinBlock:
          type: string
          description: "**Required.** The encrypted PIN block containing the new PIN"
          example: "ABC123DEF456"

    PinChanging:
      type: object
      required:
        - Pan
        - oldPinBlock
        - newPinBlock
      properties:
        Pan:
          type: string
          description: "**Required.** The Primary Account Number (PAN) of the card"
          example: "1234567890123456"
        oldPinBlock:
          type: string
          description: "**Required.** The encrypted PIN block containing the current PIN for verification"
          example: "OLD123PIN456"
        newPinBlock:
          type: string
          description: "**Required.** The encrypted PIN block containing the new PIN to be set"
          example: "NEW789PIN012"
    
    ValidationError:
      type: object
      required: [code, params]
      properties:
        code:
          type: string
          example: ERR_VALIDATION_FAILED
        params:
          type: object
          properties:
            message:
              type: string
              example: Missing required field or invalid field format
            missingProperty:
              type: string
              description: The name of the missing or invalid property
              example: CardRefNum
    
    ConflictError:
      type: object
      required: [code, params]
      properties:
        code:
          type: string
          example: ERR_CARD_DECLINED
        params:
          type: object
          required: [message]
          properties:
            message:
              type: string
              example: Operation was declined
    
    ServerError:
      type: object
      required: [code, params]
      properties:
        code:
          type: string
          enum: [ERR_SUBJECT_ID_NOT_FOUND, ERR_CLIENTID_NOT_FOUND, ERR_INTERNAL_SERVER_ERROR]
          example: ERR_INTERNAL_SERVER_ERROR
        params:
          type: object
          required: [message]
          properties:
            message:
              example: An unexpected error occurred
    
    CreateCardStandard:
      type: object
      required:
        - FirstName
        - LastName
        - BirthDate
        - Email
        - MobilePhone
        - StreetTitle
        - Zip
        - NotificationStatus
        - NationalId
        - Passport
      properties:
        FirstName:
          type: string
          description: "**Required.** Customer's first name"
          example: "John"
        LastName:
          type: string
          description: "**Required.** Customer's last name"
          example: "Doe"
        MiddleName:
          type: string
          description: "Optional. Customer's middle name"
          example: "William"
        BirthDate:
          type: string
          format: date
          pattern: '^\d{4}-\d{2}-\d{2}$'
          description: "**Required.** Birth date in YYYY-MM-DD format"
          example: "1990-01-15"
        NationalId:
          type: string
          description: "Either NationalId or Passport is required. Customer's national ID"
          example: "1234567890"
        Passport:
          type: string
          description: "Either NationalId or Passport is required. Customer's passport number"
          example: "AB1234567"
        Email:
          type: string
          format: email
          description: "**Required.** Customer's email address"
          example: "john.doe@example.com"
        MobilePhone:
          type: string
          description: "**Required.** Customer's mobile phone number"
          example: "1234567890"
        StreetTitle:
          type: string
          description: "**Required.** Customer's street address"
          example: "123 Main Street"
        Zip:
          type: string
          description: "**Required.** Customer's postal code"
          example: "12345"
        NotificationStatus:
          type: string
          enum: [enabled, disabled]
          description: "**Required.** Notification preference - enabled or disabled"
          example: "enabled"

  parameters:
    apiKey:
      name: x-api-key
      in: header
      required: true
      schema:
        type: string
      description: API key for authentication
    contentType:
      name: Content-Type
      in: header
      required: true
      schema:
        type: string
        default: application/json
      description: Content type of the request body
